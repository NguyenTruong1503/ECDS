<div class="dashboard-container">
  <mat-card>
    <mat-card-title>
      <div class="dashboard-header">
        <h4 class="dashboard-title">Trang ch·ªß</h4>
        <button mat-button class="btn-download">
          <mat-icon>file_download</mat-icon>
          Xu·∫•t file
        </button>
      </div>
    </mat-card-title>

    <mat-card-content>
      <form>
        <div class="form-search">
          <mat-form-field  appearance="outline" class="field-search">
            <mat-label>T√¨m ki·∫øm s·∫£n ph·∫©m</mat-label>
            <input matInput type="search" name="currentSearch"
                   placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m">
            <button mat-icon-button matPrefix aria-label="search" >
              <mat-icon>search</mat-icon>
            </button>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>T·∫•t c·∫£ khu v·ª±c</mat-label>
            <mat-select (selectionChange)="onChangeRegion($event)"  [(ngModel)]="regionId" name="region">
              <mat-option value="" >T·∫•t c·∫£ khu v·ª±c</mat-option>
              <mat-option *ngFor="let region of regionsData" [value]="region._id">{{region.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>T·∫•t c·∫£ ƒë·ªãa b√†n</mat-label>
            <mat-select [(ngModel)]="hospitalId" name="hospital">
              <mat-option value="">T·∫•t c·∫£ ƒë·ªãa b√†n</mat-option>
              <mat-option *ngFor="let hospital of hospitalsData" [value]="hospital._id">{{hospital.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>T·∫•t c·∫£ ƒë·∫°i l√Ω</mat-label>
            <mat-select [(ngModel)]="agentId" name="agent">
              <mat-option value="">T·∫•t c·∫£ ƒë·∫°i l√Ω</mat-option>
              <mat-option *ngFor="let agent of agentsData" [value]="agent._id">{{agent.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>T·∫•t c·∫£ tr·∫°ng th√°i</mat-label>
            <mat-select [(ngModel)]="selectedStatus">
              <mat-option value="">T·∫•t c·∫£ tr·∫°ng th√°i</mat-option>
              <mat-option *ngFor="let status of productStatuses" [value]="status">
                {{ status }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </form>

      <div class="table-wrapper">
        <div class="table-header">
          <div class="col stt">STT</div>
          <div class="col code">M√É SP</div>
          <div class="col name">T√äN SP</div>
          <div class="col group">NH√ìM NG√ÄNH</div>
          <div class="col status">TR·∫†NG TH√ÅI</div>
          <div class="col agent">ƒê·∫†I L√ù PH·ª§ TR√ÅCH</div>
          <div class="col company">C√îNG TY PH√ÇN PH·ªêI</div>
        </div>

        <div
          cdkDropList
          [cdkDropListData]="regions"
          (cdkDropListDropped)="dropArea($event)"
          class="area-list"
        >
          <ng-container *ngFor="let area of regions">
            <div class="area" cdkDrag>
              <div class="area-header" (click)="toggleArea(area)">
                <div class="area-name">
                  <span class="toggle-icon">{{ area.expanded ? 'üìÇ' : 'üìÅ' }}</span>
                  {{ area.name }}
                </div>
                <div class="note">‚ûï Th√™m ch√∫ th√≠ch</div>
              </div>

              <div *ngIf="area.expanded">
                <ng-container *ngFor="let hospital of area.hospital">
                  <div class="hospital">
                    <div class="hospital-header" >
                      <div class="hopital-name" (click)="toggleHospital(hospital)">
                        <span class="toggle-icon">{{ hospital.expanded ? '‚ûñ' : '‚ûï' }}</span>
                        {{ hospital.name }}({{hospital.products?.length}})
                      </div>
                      <div class="note">‚ûï Th√™m ch√∫ th√≠ch</div>
                    </div>

                    <div *ngIf="hospital.expanded">
                      <div *ngFor="let product of hospital.pageProducts" class="table-row">
                        <div class="col stt">{{ product.stt }}</div>
                        <div class="col code">{{ product.code }}</div>
                        <div class="col name">{{ product.name }}</div>
                        <div class="col group">{{ product.industry }}</div>
                        <div class="col status"
                             [ngClass]="{
                            'status-success': product.status === 'ƒêang tri·ªÉn khai',
                            'status-error': product.status === 'Kh√¥ng ƒë∆∞·ª£c tri·ªÉn khai',
                            'status-progress': product.status === 'Ch∆∞a tri·ªÉn khai',
                          }"
                        >
                          {{ product.status }}
                        </div>
                        <div class="col agent">{{ product.agentId?.name }}</div>
                        <div class="col company">{{ product.company }}</div>
                        <div class="col action">
                          <div class="action-icon"><mat-icon>edit</mat-icon></div>
                          <div class="action-icon"><mat-icon>delete</mat-icon></div>
                        </div>
                      </div>
                      <mat-paginator
                      [length]="hospital.products.length"
                      [pageIndex]="hospital.pageIndex || 0"
                      [pageSize]="hospital.pageSize || 5"
                      [pageSizeOptions]="[2, 5, 7]"
                      (page)="onHospitalPage($event, hospital)"
                      [showFirstLastButtons]="true"
                      *ngIf="hospital.products && hospital.products.length > 0"
                      >
                      </mat-paginator>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
